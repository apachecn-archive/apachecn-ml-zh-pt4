# 二十五、供应商重复付款

本章/配方展示了审计师如何使用 k 近邻(KNN)算法识别重复付款。在识别之后，将探索重复支付的验证方法以及与业务的交互。

这一章的结构就像一个秘籍——秘籍的目标、配料、说明、变化和服务。随附的代码可以在第 [20](20.html) 章指定的 GitHub 存储库中获得。

## 菜肴:供应商重复付款分析

几乎所有组织都错误地向供应商付款。一个常见的问题是由于付款过程中的缺陷而向供应商重复付款。考虑一个供应商更改地址的例子。在供应商主表中创建新记录来获取新地址。如果在付款过程中有一个间隙，仍然在旧地址向供应商付款，供应商可能会在意识到他们没有收到付款后给组织打电话。该组织最终可能会重新签发另一张支票，以便在新地址向供应商付款。如果原始付款没有被及时跟踪和取消，这可能会导致重复付款。

在这个分析中，我们将使用带有 KD 树索引的 k-最近邻。k-最近邻的主要思想是找到距离给定点最近的 n 个训练样本，并预测新点的标签。使用 KD 树邻居搜索，通过在 K 维树中编码样本的集合信息来减少距离计算。

这种技术将作为内部审计人员在测试、控制或流程基础上的补充工具，以避免重复支付。

## 佐料

对于此分析，使用正态分布生成了 100，000 个具有 10 个属性的随机样本。这十个属性代表付款表中的十个数字字段。

## 说明

分析中有三个步骤:准备数据、执行算法和检查任何异常。以下小节简要描述了每个步骤。

### 步骤 1:数据准备

此分析中使用的唯一数据准备是添加一个新列。新列跟踪所有列的最大规范化值与每列的规范化值之间的欧几里德距离。

### 步骤 2:执行 K-NN 算法

K-NN 算法使用 100，000 个具有 11 个(包括步骤 1 中添加的列)属性的随机样本进行训练，其中 K=1(一个邻居)。选择 KD 树索引来训练模型。在模型符合数据之后，我们准备检查给定的支付是否与模型已经看到的任何当前支付相似。

生成随机支付样本，以检查其与任何训练点的距离。显示距离和距离最小的点的索引。在我们的分析中，在索引 50753 处表示的支付具有 4.89 的最小距离。

### 步骤 3:使用附加数据复查例外

可以通过检索原始采购订单、付款和发票详细信息来检查已识别的重复项。采购订单和发票金额必须与支付给供应商的款项相符。

## 变化和服务

随机生成的支付交易表可以代替实际的支付交易。可以使用`read_csv()`功能将支付交易加载到 Jupyter 笔记本环境中。然后需要处理支付交易中的属性，以便只有数字变量用于分析。如果有分类变量，可以通过标签编码将其转化为数值变量。请参考上一章如何做到这一点。

使用这种算法可以近乎实时地识别重复付款。每次付款或每批 50 次付款都会触发 K-NN 模型使用新的付款进行重新训练。每个新付款的距离可以快速计算，以检查是否重复付款。可以应用距离的阈值来控制假正数。阈值越高，误报的数量就越少。f1 分数可用于确定对重复支付进行正确分类的准确性。f1 分数是一个调和的衡量标准，根据精确度和召回率来计算精确度。

f1-得分=2*(精确度*召回率/(精确度+召回率))

## 结论

重复支付对任何企业来说当然都不是理想的。如本章所示，应用 k-最近邻算法可以帮助您找到可能的重复项，然后您可以与企业一起验证和解决这些重复项。