# 11.机器学习在行动:例子

A breakthrough in machine learning would be worth ten Microsofts. —Bill Gates

机器学习是综合和解释数据模式和主动优化任务之间潜在关系的重要手段。机器学习利用概括的能力，这是通过人类学习形成概念的固有和必要的组成部分。学习过程构建了一个知识库，通过关键的反馈来强化知识库，从而提高绩效。知识库系统收集一组事实，并通过推理引擎对其进行处理，推理引擎使用规则和逻辑来推断新的事实或不一致之处。

随着越来越多的数据以非结构化的形式进行数字化表达，人们正在探索新的计算模型来以有意义的方式处理这些数据。这些计算模型综合了非结构化数据中嵌入的知识，并了解特定领域的趋势和属性。更复杂的模型可以促进决策支持系统，使用领域的层次结构和各自的领域特定模型。机器学习在以传统统计方法难以匹敌的方式自动、扩展和集中挖掘知识的过程中发挥着重要作用。

本章给出了机器学习作为反馈控制系统的主要组成部分的例子。我们讨论机器学习在与数据中心工作负载指纹、数据中心资源分配和自组织网络中的入侵检测相关的领域中的使用。这些例子展示了基于机器学习原理的智能反馈控制系统。这种系统可以在整个高可用性环境中实现自动检测、优化、纠正和调整，同时促进明智的决策。此外，这些系统根据平台需求、新出现的用例以及生态系统中可用知识数据的成熟度进行自我发展和训练。我们的目标是创建充当专家系统的模型，这些模型可以自动执行前瞻性的操作，这些操作可以在以后进行检查或修改(如果需要的话)。

传统的系统使用一组属性来决定当前的属性或行为。专家系统使用机器学习来发现由学习过程导致的变化的性质，并分析该过程更好适应背后的推理。这样的系统可以是历史确定的，也可以是状态确定的。状态确定系统可以用连续时间间隔中状态之间的转移来描述(如一阶马尔可夫链)。新状态由先前状态唯一确定。为了适应，生物体在来自环境的信息的指导下，必须管理其基本变量，通过操纵环境(通过生物体对环境的运动控制)迫使它们在适当的限度内运行，以便它随后适当地作用于变量。

图 [11-1](#Fig1) 展示了一个自治系统，它是通过使用模块化功能来制定一个智能反馈控制系统而构建的。机器学习在建模知识函数中起着重要的作用，知识函数用于以结构化的方式存储规则、约束和模式。新知识是利用现有结构和新知识的元素合成的。集体知识形成了一个反馈控制回路，这使得一个稳定和可行的系统。促进智能反馈控制系统的支持功能如下:

*   传感器的功能是检测内部或外部环境的任何变化(如组件温度、功率、利用率和异常行为)。
*   一种运动机能，通过改变系统元件来补偿环境干扰的影响，从而保持平衡。
*   分析功能，用于分析传感器通道数据，以确定任何基本变量是否在可行的界限或限制内运行。
*   一种规划功能，用于确定需要对当前系统行为进行哪些更改，以使系统在新环境中回到平衡状态。
*   一种知识功能，包含一组可应用于新环境的可能行为。规划工具使用该知识来选择适当的动作以消除干扰；电机通道应用选定的行为。使用概括过程来合成知识函数，这可以是基于应用于现有模型的新数据有效地开发更丰富的假设空间的正在进行的任务。

![A978-1-4302-5990-9_11_Fig1_HTML.gif](A978-1-4302-5990-9_11_Fig1_HTML.gif)

图 11-1。

Modular functions as fundamental elements for building autonomics architecture

这些功能使关键要素能够通过使用抽象的控制论描述(调节理论)来模拟实际系统。这个描述抽象了一组可以接收、存储、处理和交换数据的相关对象。控制论系统可以用控制对象和控制系统来表示。控制系统通过一组效应器将控制信息传递给受控对象。受控对象的状态信息通过一组接收器接收，并传回控制系统，从而形成反馈回路。这个反馈回路能够开发一个自主系统，通过自适应调节操作一个有效的控制系统。该模型包括以下五个必要且充分的相互作用的子系统，它们共同构成一个提供系统生存能力的组织结构:

*   与运营环境交互的基础设施，运营环境由管理流程控制。
*   协调以促进政策数据的传播，从而实现协作和协调。
*   对干预规则以及策略遵守、资源遵从、可访问性和责任的控制。
*   提前计划外部环境和能力变化的智能。智能有助于捕捉系统环境的完整视图，并有利于系统制定替代策略，这对于适应变化的条件以保持系统的可行性是必要的。
*   通过制定导致计划活动的政策功能来引导组织朝着有目的的目标前进的政策。

## 可行系统建模

受控系统在相互作用中可能表现出高度的动态性，这可能导致不可预测的行为。可行的系统建模使用监视、控制和通信抽象，促进了允许协调、共同进化和生存性的框架。这种建模有助于系统在不断变化和不可预测的环境中生存；该模型能够经受住外部压力和需求的变化，并且能够适应任何意想不到的刺激。您以这样一种方式抽象框架，即使用模型中的可变性不会干扰将系统稳定在其可行的限度内。不可预测的行为、间歇性故障和分散的知识会产生相当大的不确定性，这可能会导致被动或次优决策，并导致传统编程范例无效，这些范例基于独立性原则和静态行为模型进行操作。需要使用动态策略构建编程策略来表征和优化运行时模式。这需要对变化的动态做出响应的机制的自主实例化。此外，编程模型必须考虑策略管理、激活机制、计算和运行时适应之间的分离。可以使用抽象来实现隔离，这使得隐藏实现选择成为可能。抽象建立了组件模型的公共视图，以允许通过通信语义实现互操作性。

智能反馈控制的实现促进了自适应，这使得受控过程通过动态地适应特定的需要和要求而随时间改变其配置。由于平台中资源的故障或改变的行为，自适应通常由规则引擎触发，并且通过资源、组件或依赖性的集合的改变来实现。适应的一个必要条件是保留现有的语义，并具有重新配置和适应新环境的能力。这是通过动态地实现添加、插入和拔出组件控制器来支持的，从而添加或移除组件的功能方面。适应的两个类别如下:

*   功能适应使组件的体系结构行为适应新的需求或环境。
*   非功能适应使容器的非功能架构适应新的需求或环境(例如，安全策略或通信协议的变化)。

适应功能要求能够识别动态变化的模式和行为，这些模式和行为具有以下特性:

*   评估时间和数量的能力。建立试探法来识别需要重新配置的适当条件。反应式重新配置或调整很容易导致振荡。此外，重新配置的量取决于特定于应用的优化函数(也称为成本函数)，该函数对于给定的策略是最大化的。
*   一种加权成本函数，用于评估在多个目标函数争夺适应性的情况下特定目标的重要性。
*   成本函数的低延迟评估和优化，以满足控制函数的实时处理。
*   识别和解决由竞争目标引起的资源冲突和波动的能力。
*   记录资源属性和行为模式的能力，有助于为未来的优化和冲突解决建立合理的推理过程。

通过模式识别的知识合成扮演了一个关键的角色，模拟了随着时间重复出现的几种行为趋势。这些模式吸引了主动分析，它通过关注最重要的活动为监控和分析过程铺平了道路。模式分析通常用于确定工作流行为以及相关动作之间的对应关系。模式分析还用于预测更有可能产生期望的策略遵从性的选择，从而支持从一组可能的候选者中选择要激活的最佳动作。框架执行模型负责收集两种类型的信息:工作负载执行期间记录的原始数据和从原始数据中导出的已处理数据，这些数据被综合起来以描述行为模式。

图 [11-2](#Fig2) 概念化了一个服务器系统的适应框架，其中子功能组件被隔离成离散的和独立的块。监控功能监控性能参数和相应的资源利用率。这被记录到知识库中，知识库跟踪资源利用率和各种性能属性之间的关系。漂移检测器评估测量性能与期望性能之间的偏差。偏差(正或负)触发对成本函数以及资源控制块的校正。成本函数操纵适应度方程的相关系数，而资源控制机制基于理性推理和模糊逻辑重新评估资源分配。这个过程一直持续到所有目标都达到为止。

![A978-1-4302-5990-9_11_Fig2_HTML.gif](A978-1-4302-5990-9_11_Fig2_HTML.gif)

图 11-2。

Adaptation function of a server system; based on the feedback, the cost function block reevaluates the function weights, whereas the resource control block reevaluates resource allocation

## 示例 1:计算节点上的工作负载指纹

近年来，数据中心的功耗急剧增加，控制服务器的功耗变得至关重要。为了开发高效的服务器，服务器平台需要在线表征，以确定各种系统功能所需调整的平台参数，因为它们之间存在复杂的依赖关系。事实证明，利用从工作负载观察中获得的洞察力对服务器进行反馈导向的优化比静态配置更有效。服务器处理器和芯片组暴露了软件可配置的裕量和范围限制，称为控制参数，可以调整这些参数以实现功率和性能之间的平衡。其中一些参数由平台的基本输入/输出系统(BIOS)在引导时设置一次，并在整个过程中保持静态。引导时的一次性配置使系统对负载变化无响应。

这里给出的例子描述了一种使用机器学习算法的动态表征技术，该算法从运行时程序阶段确定调谐值。自校正工作负载指纹码本加速相位预测，以实现连续和主动调整。基于观察到的需求变化，操作系统或硬件模块可以动态地设置诸如存储器和处理器功率状态的参数。然后，自治系统根据使用情况，权衡系统余量以获得功率或性能优势。主动调优让系统提前做好自我调优的准备，避免反应式系统的响应滞后特性。各种机器学习技术，例如聚类、分类器和离散相位预测器，被应用于从处理器的子系统收集的数据。此外，确定适当的算法和操作是至关重要的，同时以最小的计算成本考虑外推效率。

性能监控单元通过硬件计数器促进了细粒度事件的测量。这些计数器允许应用程序探查器揭示应用程序在其生存期内以定义的模式重复的时变阶段行为。一个计划阶段可以被描述为一个时间上的不连续性，在这个不连续性中，可观察的特性变化明显，足以影响一个同样可测量的系统影响变化。已知相位的相位特征和概率序列被表示为指纹。指纹有助于在数据中心的一组服务器中实现负载平衡、热量控制和资源分配的主动模式。学习过程中采用的步骤可以总结如下:

Execute the workload in the server system(s).   Identify relevant process control parameters, and relate them to process goals (workload throughput, server power, thermal variance, and so on).   Synthesize the attributes of a phase and phase sequence.   Build a phase prediction model to forecast future behavior of the workload.   Tune the system control parameters proactively.  

工作负载指纹允许主动的自我调整，这通过学习操作工作负载阶段和相应的应用行为之间的基本关系来避免反馈和控制(或反应控制)之间的滞后，从而促进在变化的环境中的动态适应。了解应用行为也是推动若干新架构特性的关键洞察力来源，例如内置内存功耗控制、热量调节、睿频加速、处理器高速缓存大小自适应和链路配置。构成决策空间的特定功能控制通过多目标协调调整过程被动态调整到当前和未来阶段，以获得全局最优结果。传统上，流程的决策空间是由控制参数定义的，这些参数是基于对通过运行众所周知的基准和建立平均案例收集的数据进行离线经验分析而获得的见解进行调整的。然后，这些控制参数由系统 BIOS 在引导时静态编程。更好的方法是使用机器学习方法，利用智能的基于反馈的自调整过程，对通过主动模拟合成的参数值进行动态编程。

### 相位决定

使用人们熟知的基准测试工具作为模拟真实工作负载行为的模型是很常见的，因为它们的完成时间是有限的，同时表现出独特的资源使用模式。基于要实现的目标，研究人员已经以多种方式定义和扩展了计划阶段。该示例将程序阶段定义为执行期间的可变时间间隔，其中一组可观察的特征表现出空间一致性和独特性。该示例使用多变量相位确定技术，该技术由多个主要变量组成，这些变量既可从外部观察到，又与平台控制变量相关。测量变量 m <sub>i</sub> 是运行一系列引导工作负载时从硬件计数器获得的性能事件值。这个初始数据集 M ![A978-1-4302-5990-9_11_Figa_HTML.jpg](A978-1-4302-5990-9_11_Figa_HTML.jpg)的元素充当阶段模型的构建块。

选择 N 个变量进行测量的动机来自于研究的目的。特征选择过程通常应用于大型数据集，以滤除相关性，并极大地降低后续阶段算法的计算复杂度。为了提高分类器的准确性和效率，一些特殊的工具，如基于相关性的特征选择(CFS)算法，被用来降低数据集的维数。CFS 是一种最佳优先搜索启发式算法，它对子集而不是单个特征的价值进行排序。该算法通过计算特征-类别和特征-特征矩阵，筛选出在预测类别时有效的特征，以及子集中特征之间的相互关联程度。CFS 选择的特征表现出与参考类的高度相关性，但是冗余变量被移除。给定由 k 个特征组成的子集 S，启发式得分被给定为

![A978-1-4302-5990-9_11_Figb_HTML.jpg](A978-1-4302-5990-9_11_Figb_HTML.jpg)

其中![A978-1-4302-5990-9_11_Figc_HTML.jpg](A978-1-4302-5990-9_11_Figc_HTML.jpg)是平均特征-类别相关性，![A978-1-4302-5990-9_11_Figd_HTML.jpg](A978-1-4302-5990-9_11_Figd_HTML.jpg)是平均特征-特征间相关性。

CFS 将测量变量集 M 转换为缩减变量集 D，得到![A978-1-4302-5990-9_11_Fige_HTML.jpg](A978-1-4302-5990-9_11_Fige_HTML.jpg)，D = CFS(M)，和![A978-1-4302-5990-9_11_Figf_HTML.jpg](A978-1-4302-5990-9_11_Figf_HTML.jpg)。下一步是通过使用选择的特征和应用简单的 k-means 算法对不相关的变量实例进行分组来构建相位模型。k-means 算法是一种无监督的机器学习算法，它将输入集划分为 k 个聚类，这样每个观察值都属于具有最近平均值(欧几里德距离)的聚类。k-means 算法的目标函数可以表示为

![A978-1-4302-5990-9_11_Figg_HTML.jpg](A978-1-4302-5990-9_11_Figg_HTML.jpg)

其中 c <sub>l</sub> 是聚类 l 的所选质心，![A978-1-4302-5990-9_11_Figh_HTML.jpg](A978-1-4302-5990-9_11_Figh_HTML.jpg)表示第 l 个聚类中的第 m 个数据点。你认为每个集群是一个阶段φ。这个例子中，k = 5，产生了一个具有 12 个过滤变量的平均值和标准偏差的模型(见图 [11-3](#Fig3) )。

![A978-1-4302-5990-9_11_Fig3_HTML.gif](A978-1-4302-5990-9_11_Fig3_HTML.gif)

图 11-3。

Phase model: cluster mean and standard deviation

一旦对阶段模型进行了训练，就可以针对工作负载数据的后续运行对其进行测试。来自相关类别的机器学习算法的分类器算法可以生成树、一组规则或概率模型来快速识别正确的阶段。一个例子是在用聚类数据训练时从决策树分类器算法获得的树表示，如图 [11-4](#Fig4) 所示。该分类器在相位识别方面达到大约 99%的准确度。

![A978-1-4302-5990-9_11_Fig4_HTML.gif](A978-1-4302-5990-9_11_Fig4_HTML.gif)

图 11-4。

Decision tree representation of the model

37 个工作负载的初始训练数据集产生五个集群，每个集群代表一个工作负载阶段(参见图 [11-5](#Fig5) )。在每个阶段，12 个主要特征显示了不同的变化模式，至少有一个特征是主要的预测因素。如前所述，使用特定于特征的阈值，可以通过分类器树来识别相变。

![A978-1-4302-5990-9_11_Fig5_HTML.gif](A978-1-4302-5990-9_11_Fig5_HTML.gif)

图 11-5。

Phase transition diagram for various workloads

图 [11-6](#Fig6) 显示了工作负载阶段边界，在四个工作负载中发现了七个集群。每个工作负载都有一个独特的工作负载阶段组成。一旦确定了工作负载，就可以根据其资源利用率和时间序列模式对其进行阶段划分。工作负载 3 主要由阶段 7 组成，而工作负载 1 是阶段 3、5 和 6 的复杂组合。这些阶段发现在任何给定时间工作负载实例特有的特征。

![A978-1-4302-5990-9_11_Fig6_HTML.gif](A978-1-4302-5990-9_11_Fig6_HTML.gif)

图 11-6。

Workload and phase dependency graph; a workload may share phase characteristics with other workloads and can cater to one or more phases

### 指纹识别

工作负载经历多个执行阶段，同时在多个约束条件下运行。这些限制与功耗、发热和服务质量(QoS)要求有关。由于在功率和性能参数调整方面的各种自由度，最佳系统操作涉及复杂的选择。该过程包括建模方法、实现选择和动态调整。指纹识别作为一种基本特征，可以捕捉动态适应系统的时变行为。这种能力被用作统计输出，其有助于在需求变化之前重新配置硬件和软件，并且能够在循环阶段重用训练好的模型。模式检测还有助于预测工作负载执行期间的未来阶段，从而防止对工作负载行为变化的被动响应。

作为工作负载识别过程的一部分(见图 [11-7](#Fig7) )，在给定的时间间隔内收集单个性能特征，对其进行分类和汇总，以建立代表现有工作负载或工作负载集合的模式。系统控制代理(如 I/O 调度程序、电源分配和动态随机存取存储器(DRAM)页面策略设置)可以使用这些信息来实时调整其参数或调度工作负载。指纹可以粗略地归结为三个属性:大小、相位和模式。机器学习过程通过在有限时期内测量或数据挖掘性能特征来促进这些特性的综合。通常，功能选择过程允许性能矩阵与独特工作负载行为的出现自动关联，从而有助于快速诊断和主动调整。指纹数据可以与简单的统计功能(如优化、可视化或控制理论)相结合，以创建强大的操作员工具。此外，指纹有助于控制一个或多个指定服务级别目标(SLO)的长期违规，包括执行主动措施以使系统恢复到 SLO 合规状态。

![A978-1-4302-5990-9_11_Fig7_HTML.gif](A978-1-4302-5990-9_11_Fig7_HTML.gif)

图 11-7。

Workload fingerprint: a quantifiable form of characterization

#### 大小属性

size 属性在主动提供资源时非常有用。使用尺寸标注可以回答以下问题:

*   分布的形状是什么？哪些资源比其他资源更受欢迎？是否存在显著的尾部？
*   在峰值期间，对流行对象组的访问的空间位置是什么？

#### 阶段属性

一个阶段代表了一个独特的属性，它描述了一个正在进行的过程的行为。在本例中，相位展示了独特的功率、温度和性能特征。如前所述(参见“阶段确定”一节)，这个例子使用了一个简单的 k-means 算法来合成集群形式的排他行为，表示为阶段。一旦识别了所有相关的特征向量，就执行这个过程。这些向量是直接或间接反映资源使用形式的独特行为的观察结果。这些阶段是压缩的代表性输出，可以与任何其他用于行为预测的统计参数结合使用。阶段序列可以被视为模式。模式代表了工作负载独特的时变特征。图 [11-8a](#Fig8) 显示了一个工作负载执行期间的阶段顺序。图 [11-8b](#Fig8) 显示了相位序列的编码表示。

![A978-1-4302-5990-9_11_Fig8a_HTML.gif](A978-1-4302-5990-9_11_Fig8a_HTML.gif) ![A978-1-4302-5990-9_11_Fig8b_HTML.gif](A978-1-4302-5990-9_11_Fig8b_HTML.gif)

图 11-8。

(a) Test workload phases, (b) run-length encoded phase sequence, and (c) phase transition likelihood matrix and workload–phase dependency matrix; the workload 1 phase dependency is highlighted

#### 模式属性

模式被定义为一系列重复的阶段。一旦识别出一个序列，就可以用它来预测未来的阶段和当前阶段的持续时间。在时序操作中，您为时序模式数据库构建词汇表。词汇表中的每个字母表都由工作负载的操作阶段表示。该相位以固定的长度间隔(T)来测量。模式矩阵可以表示为 M <sub>ij</sub> ，其中 I 代表模式，j 代表该模式的频率。随着新模式被识别，它们被更新到模式矩阵中，旧的和不常用的模式被废弃。你可以使用离散时间马尔可夫链(DTMC)(见等式 11-3)来识别变化阶段的时间序列中的潜在模式，

![A978-1-4302-5990-9_11_Figi_HTML.jpg](A978-1-4302-5990-9_11_Figi_HTML.jpg)

其中 q <sub>t</sub> 表示当前状态，S <sub>i</sub> 表示操作的一个阶段。在此模型中，状态转换(阶段变化)遵循马尔可夫属性，然后基于预测的学习模型创建状态(阶段)之间的转换。您可以使用移动窗口来监控实时数据，并为最近观察到的数据生成自回归模型，然后将该模型与学习到的马尔可夫模型的状态进行匹配。如有必要，该模型还会进行修正以适应这些变化。通过追踪从一个阶段到另一个阶段的时间序列进展，你可以建立马尔可夫模型的转移函数(见图 [11-8c](#Fig8) )。

### 预测

工作负载预测模块检测工作负载的趋势，并预测未来的工作负载量。如果目标工作负载表现出强烈的周期性行为，则可以将历史预测合并到工作负载预测中。这使得策略决策能够提前对工作负载高峰做出主动反应。这也有助于您利用云计算提供商提供的异构计算和 I/O 资源。此外，基于提取的模式，您可以以创建不同性能模型的方式来分配工作负载。

## 示例 2:动态能量分配

近年来，控制服务器机器消耗的功率量变得越来越重要。三种类型的操作的准确性和敏捷性在电源治理中至关重要:

*   选择哪些硬件元素必须以什么速率运行，以满足软件的性能需求
*   评估需要扩展多少功率才能达到这些速率
*   根据计算需求的变化调整电力支出

观察工作负载的变化如何影响不同服务器组件的功耗，可以为分析和构建 QoS 预期与功耗之间的关系模型提供关键数据。下一个示例描述了在英特尔至强服务器上实现自主电源控制的观察、建模和过程校正过程，以满足数据库查询工作负载执行期间不断变化的响应时间和吞吐量需求。该过程从系统中一组分布式物理和逻辑传感器所允许的细粒度功率性能观察开始。这些观察结果用于为工作负载的各个阶段训练模型。一旦经过训练，系统功率、吞吐量和延迟模型将参与优化试探法，重新分配功率以最大化服务器的整体性能功耗比。

术语“功耗优化”是指在应用程序级别瞄准并实现高水平的功耗标准化性能的行为。对于一个软件应用程序，比如业务交易服务或内容检索服务，重要的性能指标包括服务的请求数量(吞吐量)和每个请求的周转延迟(响应时间)。优化功耗需要多重动态权衡。通常，系统可以表示为一组组件，它们的协作交互产生有用的工作。这些组件可能是异构的，或者具有异构的负载，并且它们的功耗和功率控制机制可能不同。在任何组件级别，如处理单元或存储单元，都需要不断增加或减少功耗，具体取决于该组件的速度是否在程序的整体执行速度或速率中发挥关键作用。特别地，不同的应用阶段可能对部件速度具有不同的敏感度。例如，与受 CPU 限制的执行阶段相比，受内存限制的执行阶段受中央处理器(CPU)频率调整的影响较小。随着大多数现代处理器采用的执行重新排序，程序从无序执行中获益的程度因阶段而异。此外，新工作到达系统的速率会发生变化，因此，程序为满足给定的服务级别期望而必须执行的总体速度会随时间而变化。因此，所需的功率性能权衡必须持续进行。

可以说，鉴于当今系统中常见的自我校正和自我调节功能，软件驱动的电源性能应该是不必要的。例如，在功率控制算法中，CPU 和 DRAMs 在低活动期会转换到较低频率或超低功耗模式。尽管电路级自调节非常有利于将组件转换到低功耗状态，但软件需要对应该减少哪些活动以及何时减少活动进行策略控制，以促进硬件转换到节能模式。

在不太繁忙的服务器上利用节能是一项微妙的任务，很难委托给基于硬件的方案。服务器通常被配置为以尽可能低的延迟处理高速率的传入工作请求。因此，服务器拥有许多 CPU 和大量物理内存的情况并不罕见，在高需求和低需求期间，计算和数据都广泛分布在这些内存上。由于活动的分布式性质，降低单个 CPU 或 DRAM 的速度可能会产生不可预测的性能后果；将服务器的一部分推入超低功耗运行可能会适得其反。在另一个极端，当功率接近饱和水平时，硬件不适合确定或执行关于哪些软件活动可以容忍降低的性能以及哪些必须像以前一样继续的决策。

因此，软件必须与硬件分担确定何时以及在哪个部件中可以省电的责任。这里，我们考虑一种自主解决方案，用于对服务器配置的功耗性能权衡进行细粒度控制。该解决方案包括用于观察、分析、规划和控制动态功耗的成分，以追求被指定为 SLO 的应用级性能目标。这种解决方案使用时变数据库查询工作负载，其中学习机同时改变 CPU 和 DRAM 的功率分配，并通过服务器中的一组分布式物理和逻辑传感器收集性能和功率读数。通过这些观察，为工作负载的各个阶段训练模型。基于这些模型，优化试探法重新分配功率，以最大化服务器的整体性能功耗比。实验测量表明，如果性能目标需要或允许，启发式算法可以提高性能和能力。

### 学习过程:特征选择

学习过程的主要作用是确定总功耗(P)和两个性能指标之间的关系:响应时间(R)和吞吐量(T)。这些关系被合成为模型，优化技术使用这些模型来实现更好的功率性能效率。概括的过程需要分类器，该分类器输入离散特征向量的向量并输出操作阶段，该操作阶段可以概括如下:

*   主要组件(CPU 和双列直插式内存模块[DIMM])的多个电源轨上的细粒度和时间一致的组件级电源读数
*   对应于三个量的系统级读数，每个量在一小段时间间隔内取平均值:(1) P，总系统功率；(2) T，应用级吞吐量；以及(3) R，请求经历的响应时间

组件级功率读数与{P，T，R}元组对齐。然后，整个数据集合被用于将{P，T，R}空间划分成类(阶段)。在每个等级或阶段内，线性函数可以将 P、T 和 R 与部件级功率读数相关联。这些线性关系用于优化规划，其目标可能是最小化 P(总系统功率)或最大化 T(应用级吞吐量)，但 R(响应时间)不超过特定阈值。学习在网上继续。因此，随着工作负载的变化，模型和优化规划也会随之变化。

可以采用支持向量机(SVM)技术将{P，T，R}空间划分成不同的阶段，并获得控制每个阶段中{P，T，R}变量的线性关系。如前所述，SVM 是一种计算高效且强大的技术；由 Boser、Guyon 和 Vapnik (1992 年)发明，用于各种机器学习问题的分类和回归。给定将一组训练输入与输出相关联的数据集合，SVM 是完成这些任务的数学实体:

The SVM describes a hyperplane (in some higher dimension) whose projection into the input space separates inputs into equivalence classes, such that the inputs in a given class have a linear function mapping them to outputs that is distinctive for that class.   The hyperplane whose projection is the SVM maximizes the distance that separates it from the nearest samples from each of the classes, thus maximizing the distances between classes, subject to a softness margin.   The SVM creates a softness margin that permits a bounded classification error, whereby a small fraction of the inputs that should be placed on one side of the projection are instead placed within a bounded distance on the other side (and are therefore misclassified); this margin allows a pragmatic tradeoff between having a high degree of separation between classes (i.e., better distinctiveness) and having too many outliers.  

等式 11-4 将{P，T，R}的每个元素表示为每个给定类别或阶段内每个处理器的五个功率读数的线性函数。(V <sub>CPU</sub> 产生进入处理器的功率，而 V <sub>DIMM</sub> 测量连接到处理器并由处理器控制的内存模块中的功率。变量 J 表示给定的类，{P <sub>J</sub> (t)，R <sub>J</sub> (t)，T <sub>J</sub> (t)}表示来自训练集中编号为 T 的样本的元组，与该样本相关联的各种功率读数由 V*(t)表示。J 阶段；常数 K* <sub>P</sub> ，K* <sub>R</sub> ，K *<sub>T</sub>；系数![A978-1-4302-5990-9_11_Figj_HTML.jpg](A978-1-4302-5990-9_11_Figj_HTML.jpg)和![A978-1-4302-5990-9_11_Figk_HTML.jpg](A978-1-4302-5990-9_11_Figk_HTML.jpg)都是通过 SVM 回归技术估计的。

![A978-1-4302-5990-9_11_Figl_HTML.jpg](A978-1-4302-5990-9_11_Figl_HTML.jpg)

### 学习过程:优化计划

能源和性能模型有许多自由度和相互冲突的目标，很难共同优化。例如，考虑以下目标:

*   最佳性能功耗比
*   保持在功率极限内
*   响应时间≤服务级别协议(SLA)阈值

这些目标之间可能会出现冲突，考虑因素如下

*   如何在系统功率预算内获得给定的吞吐量
*   如何在响应时间阈值下获得给定的吞吐量

在一般情况下，P(系统总功耗)受吞吐量和响应时间这两个性能目标的影响。同样，在一般情况下，性能会受到处理器和 DIMM 模块功耗的影响。因此，优化规划必须努力满足一个复合目标:在这个复合目标中，为一个目标花费的能量通常是以另一个目标为代价的。一旦合成了功率、吞吐量和响应时间的线性估计模型的系数，这些模型就可以通过反馈控制回路用作多目标优化中的合成反馈。该示例使用自适应加权遗传算法(AWGA)方法在具有多个目标的场景中搜索全局最优。在这种机器学习技术中，成功的结果被定义为以功率、响应时间和吞吐量的倒数都满足可行限制的方式重新分配功率。更一般地，一组适应度函数{f <sub>n</sub> }，每个目标 n 一个，确定每个目标的候选设置(即，描述组件间功率分布的向量)的最优性。在 AWGA，对于候选设置{x}，![A978-1-4302-5990-9_11_Figm_HTML.jpg](A978-1-4302-5990-9_11_Figm_HTML.jpg))和![A978-1-4302-5990-9_11_Fign_HTML.jpg](A978-1-4302-5990-9_11_Fign_HTML.jpg) = min(fn(x)|x ![A978-1-4302-5990-9_11_Figae_HTML.jpg](A978-1-4302-5990-9_11_Figae_HTML.jpg) f)的群体 f，分别计算 n = 1，2，.。。，N 个目标，其中 f 中的每个 x 是一个向量，其适应度函数表示组件(如 CPU 和 DIMMs)之间可行的功率分配。然后，您可以选择一个 N 目标适应度函数 F 来评估总适应度值。例如，在 AWGA 的情况下，F 可以选择为

![A978-1-4302-5990-9_11_Figo_HTML.jpg](A978-1-4302-5990-9_11_Figo_HTML.jpg)

进化算法(EA)从给定的 f 代中选择亲代(通常采用精英主义过程，允许当前代的最佳解决方案不变地延续到下一代)，从中产生幂可行的后代作为下一代的新候选。在目标空间中，![A978-1-4302-5990-9_11_Figp_HTML.jpg](A978-1-4302-5990-9_11_Figp_HTML.jpg)和![A978-1-4302-5990-9_11_Figq_HTML.jpg](A978-1-4302-5990-9_11_Figq_HTML.jpg)代表每一代更新的极值点。作为极值点，适应度界限{( ![A978-1-4302-5990-9_11_Figr_HTML.jpg](A978-1-4302-5990-9_11_Figr_HTML.jpg) )|n = 1，2，.。。，N}在每一代更新，并且每个目标的贡献(权重)也相应地更新。

### 学习过程:监控

实现高能效表现并遵守功耗和性能限制要求实时反馈控制。一个自主系统实现连续的基于反馈的航向修正，具有以下规定:

*   监控基础设施，以采样或量化物理和逻辑指标，如功率、温度和活动率，并获得指标的统计矩
*   分析模块，提取被监控量之间的关系(例如，功率、温度和性能之间的关系)，并确定一个或多个操作目标是否处于风险中
*   一种规划元素，用于制定一系列行动，如暂停、恢复、加速或减慢系统的各个部分，以实现特定的策略选择(如限制消耗的功率或能量，或提高性能)
*   执行制定的计划并由此控制系统运行的能力

通常，知识库是对分析和计划的补充。知识库可以是一个信息库，它对每个系统状态中允许的动作进行分类，或者它可以隐含在分析、规划和控制功能的逻辑中。在为可扩展性而设计的系统中，知识库通常包含一个自适应机制，该机制跟踪并学习先前的决策和结果。对于智能反馈控制过程，细粒度和轻度干扰的电源性能监控是自适应电源管理基础设施的关键要素。理想的监控机制实时运行(即报告尽可能新的数据)，并且不受被监控行为的影响。在这种配置中，操作系统和软件级别的逻辑传感器提供近乎实时的信息流，该信息流由通用系统调用、存储访问和网络传输的速率组成。这些逻辑传感器通过物理传感器进行功率检测。

遥测总线用于从物理(硬件)和逻辑(软件)传感器收集数据，并将它们发送到监控代理。具体而言，功率感测是通过感测每个处理器芯片处的电压调节器(VR)输出来实现的。遥测数据被发送到的监控代理处理数据，将它们组织为功率和性能统计的时间对齐的流，并将该流传输到远程机器以供进一步存储或分析。监控基础设施提供了获取每个处理器的不同功率读数的能力。每个处理器控制不同的内存通道，每个通道有多个 DIMMs 每对存储通道提供一个 V <sub>DDQ</sub> 信号；将这些 V <sub>DDQ</sub> 读数相加，得出每个处理器在内存子系统中消耗的功率。这些传感器收集的数据通过一系列的转换进行提炼(见图 [11-9](#Fig9) ):

![A978-1-4302-5990-9_11_Fig9_HTML.gif](A978-1-4302-5990-9_11_Fig9_HTML.gif)

图 11-9。

Sensor network model: sensor network layered architecture (S1, S2, . . . , Sn) represents platform sensors (CPU/DIMM power, thermal, performance, and so on). Source: A Vision for Platform Autonomy: Robust Frameworks for Systems (Intel, 2011)

*   传感器硬件抽象(SHA)层:这一层与传感器和通信通道交互。它使用自适应采样，这样测量只在必要时才频繁进行，并且它消除了冗余。
*   平台传感器分析器:这一层去除噪声并隔离趋势，这使得在进一步处理中更容易将最近和历史数据作为输入。
*   平台传感器抽象:这一层提供了一个编程接口，用于通过在其上实现的控制程序灵活处理分析的传感器数据。
*   平台传感器事件生成:这一层使得生成信号成为可能。信号促进了来自控制程序的基于事件的对话，从而允许在一组分布式容器(例如本地或远程控制器软件和操作系统模块)中托管进一步的控制。先前的连续改进弥合了传感器产生的原始数据与软件模块可以接收和进一步分析的性能和功率读数和警报的有序处理流之间的差距。

虽然机器可以很容易地配备计量电源来检测总功率，但产生功率的细粒度分解的仪器功能需要付出不小的努力。此外，就成本而言，在生产机器中添加许多物理功率传感器既不必要也不实际。当直接测量不可行时，现代机器中的事件计数功能提供了一种有效的替代方法来估计组件功率。一种简单而准确的估算最新 CPU 功耗的方法是，使用经过训练的模型，根据使用情况和功耗状态预测功耗。通过包括捕获指令的哪一部分属于一小组类别中的每一个类别的执行简档，例如单指令、多数据(SIMD)，可以使这种训练更加准确；加载/存储；和算术逻辑单元(ALU)。类似地，可以基于高速缓存未命中计数或者在存储器控制器处计数并通过处理器事件监视器跟踪的 DRAM 操作来估计 DRAM 功率。DRAM 功率估计允许以足够的精度在 DIMM 粒度测量 DRAM 能量，以实现对 DRAM 功率状态的有效控制。有效控制 DRAM 能量不仅可以降低硬件基础设施的成本，还可以通过减少补偿预测不足所需的保护频带来提高能效。此外，还可以减少过度预测，以避免性能下降。

通过过程控制方法获得有助于竞争组件之间的功率最佳分配的决策空间，其中特权软件可以修改其功率汲取。第一种方法是改变 P 状态和 C 状态，这种方法通常用于基于英特尔的处理器(Siddha 2007)。第二种方法是改变平均功率水平，对 CPU 和 DRAM 模块使用称为运行平均功率限制(RAPL)功能的控制。CPU RAPL 提供了为特定时间窗口设置功率预算的接口，并让硬件满足能源目标。将功率限制指定为一个时间窗口内的平均值允许我们表示物理功率和热约束。特权软件可以通过将期望的平均功率水平编程到接口寄存器来使用 RAPL 能力，其中硬件可以通过在可编程控制窗口上其自己的校正频率调整来引导处理器达到该期望的平均功率水平。选择窗口大小和功率限制，使得在单机级别或数据中心级别，快速驱动对机器功率的校正。在实践中，窗口大小可以在毫秒和秒之间变化——前者满足功率输送限制，后者管理热限制。RAPL 概念也扩展到了内存系统，这得益于在英特尔平台的几个最新版本中将内存控制器集成到每个多核处理器中。虽然 CPU 和内存能量可以单独调节，但可以建立一种协调的自调整方法，其中功率调节是下一节讨论的机器学习技术支持的联合优化功能的一部分。

## 模型训练:程序与评估

对于模型训练，数据收集模块从功率监控传感器收集时间校准的读数。此外，它还从数据库性能模块收集响应时间和请求完成率。这些读数提供了输入-输出训练向量![A978-1-4302-5990-9_11_Figs_HTML.jpg](A978-1-4302-5990-9_11_Figs_HTML.jpg)(见等式 11-4)。训练数据是通过两组变量的叉积获得的:

*   需求的变化:该参数控制工作负载驱动程序中的多个线程在完成前一个请求和发出新请求之间等待的时间。
*   电源变化:该控制改变 CPU 和内存 RAPL 设置，从而改变 CPU 和 DRAM 的电源。

在此示例中，工作负载使用从 0 到 100 的时变思考时间。对于每个思考时间，CPU RAPL 限制在 20W 和 95W 之间变化。基于这些数据的 SVMmodel 训练然后被用于将数据分类到不同的阶段(J)，随后评估每个阶段![A978-1-4302-5990-9_11_Figt_HTML.jpg](A978-1-4302-5990-9_11_Figt_HTML.jpg)的 SVM 模型参数。

基于 SVM 的分类产生了三个阶段的分解，如图 [11-10](#Fig10) 所示。

![A978-1-4302-5990-9_11_Fig10_HTML.gif](A978-1-4302-5990-9_11_Fig10_HTML.gif)

图 11-10。

Model tree depicting three phases (P0, P1, P2) in a workload characterized by throughput and response time

因此，等式 11-4 中的三组不同的建模参数(即，对于 J = 0，1，2)将 CPU RAPL 参数与总系统功率、吞吐量和响应时间结果相关联。图 [11-10](#Fig10) 展示了根据等式 11-4 中的 RAPL 参数估算的总壁功率与实际测量值的比较。图 [11-11](#Fig11) 和 [11-12](#Fig12) 显示了培训的估计结果和测量结果之间的紧密一致。

![A978-1-4302-5990-9_11_Fig12_HTML.gif](A978-1-4302-5990-9_11_Fig12_HTML.gif)

图 11-12。

CPU power, measured versus estimated; estimated CPU power is phase wise and based on the throughput and target latency requirements

![A978-1-4302-5990-9_11_Fig11_HTML.gif](A978-1-4302-5990-9_11_Fig11_HTML.gif)

图 11-11。

Wall power, measured versus estimated (as function of component power)

平均而言，SVM 支持的机器学习回归函数的准确率在 97%到 98.5%之间。每个阶段都针对其自身的性能和延迟模型系数进行训练。

图 [11-13](#Fig13) 描述了一个由服务器上四种可能的工作负载条件组成的示例。在 x 轴上，tt00、tt10 和 tt20 分别代表 0.0 毫秒、10.0 毫秒和 20.0 毫秒的思考时间。y 轴显示响应时间。图中红色多段线连接四个工作负荷点(W <sub>1</sub> ，W <sub>2</sub> ，W <sub>3</sub> ，W <sub>4</sub> )。这些点是供求关系中随机选择的扰动；比如 W <sub>1</sub> 是设置思考时间 20.0ms，CPU RAPL 值 40W 的结果；W <sub>2</sub> 来自 0.0ms 的思考时间(驱动比 W <sub>1</sub> 更高的到达率)和 50W 的 CPU RAPL 值，以此类推。

![A978-1-4302-5990-9_11_Fig13_HTML.gif](A978-1-4302-5990-9_11_Fig13_HTML.gif)

图 11-13。

Response time at four arbitrarily selected points, reflecting four possible workload and server conditions

如果 W <sub>1</sub> 、W <sub>2</sub> 、W <sub>3</sub> 和 W <sub>4</sub> 的响应时间都没有超过期望的性能目标(例如，R = 20.0ms 的 SLA 目标)，那么只要更高的响应时间仍然低于 20.0ms 的目标，就希望通过降低性能来节省功率。然而，如果在这些工作负载点中的任何一个点，响应时间都超过了期望的阈值，那么最好通过以下方式来提高性能

通常，SLA 可能会详细说明吞吐量和响应时间预期，并且可能会包括一些细节，例如在不同吞吐量级别下，必须在阈值响应时间内完成的工作负载部分。为了便于描述，这个例子有一个简单的 SLA 设置:在很短的时间间隔(1s)内平均的响应时间不超过 14.0ms 的静态目标值；这在图 [11-14](#Fig14) 中用实线显示，R = 0.014。

![A978-1-4302-5990-9_11_Fig14_HTML.gif](A978-1-4302-5990-9_11_Fig14_HTML.gif)

图 11-14。

Illustration of improvement in response time, using proactive control of CPU power employing CPU RAPL

如您所见，新的工作负载点(以菱形显示)是通过使用经过训练的 SVM 模型进行主动电源性能控制而产生的。此外，使用训练模型计算的新的 RAPL 设置(更高的 CPU 能力)将 W <sub>1</sub> 和 W <sub>2</sub> 的响应时间从它们以前的值(分别减少 15%和 7%)减少到更接近 SLA 的新值。类似地，模型训练为 W <sub>3</sub> 和 W <sub>4</sub> 产生较低的 CPU 功率设置，这导致以更高的响应时间为代价的功率节省，并导致 11.5%的能量效率改进。顺便提一下，W <sub>4</sub> 的新设置与 SLA 目标相差很小，但不可忽略，这可能会迫使在下一次迭代中重新计算 CPU RAPL 设置。注意，为了减少频繁的航向修正，控制策略可以允许在任一方向上以小幅度超出 SLA 目标。这里，因为 W <sub>1</sub> 和 W <sub>2</sub> 的新 RAPL 设置减少了响应时间，所以相对于隔离调谐，相位感知 CPU 功率调整在所有性能级别都显著降低了功率。

## 示例 3:入侵检测的系统方法

在一个合作的 ad hoc 网络和无处不在的无线连接的时代，我们变得更容易受到恶意攻击。在入侵尝试期间，这些复杂的攻击在阈值边界下运行，并且只能通过分析与正常行为相关的完整系统活动来识别。这些攻击中有许多本质上是无声的，无法被传统的入侵检测系统(IDS)方法检测到，例如流量监控、端口扫描或违反协议。入侵检测可以比作人类的免疫系统，通过理解正常过程的规范，识别并消除异常。标识符应该以可识别和可适应的关系分布在整个系统中。因此，我们需要一个模型，在每个状态下，有一个产生可观测系统输出的概率和一个指示下一个状态的单独概率。

与有线网络不同，自组织节点在成员节点之间进行协调，以允许独占使用通信信道。恶意节点可以利用协作节点的这种分布式和复杂的决策属性来发起对节点的攻击或劫持。这种固有的漏洞会使整个网络群集瘫痪，并通过假冒、消息污染、被动侦听或充当恶意路由器来进一步危害安全性。IDS 机制应该能够通过与用户配置文件和发展趋势进行比较来监控系统中的异常活动，从而检测入侵。虽然如果攻击者在阈值以下操作，它们可能不足以防止恶意攻击，但是可以修改基于阈值的机制来监视相关系统组件的趋势，以预测攻击。这类似于 HMM(见[第 5 章](05.html))，其中隐藏状态(攻击)可以从相关观察(系统参数、故障频率等的变化)中预测。观察到的行为充当正常或异常活动的签名或描述，并以统计度量和模型为特征。指标是一个随机变量，代表一段时间内累积的定量测量。从审计记录中获得的观察结果，当与统计模型一起使用时，分析与标准配置文件的任何偏差，并触发可能的入侵状态。

这个例子讨论了一个基于 HMM 的入侵检测策略，使用一个多变量高斯模型来预测以隐藏状态存在的攻击。该模型包括用于事件聚类的自组织网络、观察分类器、漂移检测器、简档估计器(PE)、高斯混合模型(GMM)加速器和 HMM 引擎。这种方法旨在根据观察到的与正常配置文件的偏差或通过将这些偏差分类到适当的攻击配置文件来预测入侵状态。HMM 是离散事件的随机模型，是马尔可夫链的变体。像传统的马尔可夫链一样，HMM 由一组离散状态和状态转移概率的矩阵 A = {a <sub>ij</sub> }组成。此外，每个状态都有一个观察到的符号概率的向量，B = b <sub>j</sub> (v)，它对应于当系统处于状态 j 时将产生类型 v 的符号的概率。HMM 的状态只能从观察到的符号中推断出来，因此有术语“隐藏”。HMM 将观察结果与隐藏状态相关联，隐藏状态是系统设计中的因素，其中观察点被优化，使用一组可接受的系统范围的入侵检查点(ICs)；使用与这些观察值的概率关系的明确知识来创建隐藏状态。这些关系(也称为概要文件)随着多个独立系统的不断使用而强化和发展。如果观察点可以标准化，那么入侵可预测性的问题可以简化为对标准观察的现有和新的隐藏状态进行剖析。

### 建模方案

HMM 建模方案的参数包括观察状态、隐藏(入侵)状态和 HMM 简档。使用初始数据和连续重新估计的 HMM 训练创建了涉及转移概率和观察符号概率的简档。HMM 建模涉及以下任务:

*   测量观察到的状态，这些状态通过分析或逻辑从入侵指示器中导出。这些指示器是遍布整个系统的测试点。
*   在给定隐藏状态的情况下，估计指示观察的概率的瞬时观察概率函数。该密度函数可以使用显式参数模型(多变量高斯)进行估计，或者通过非参数方法(多变量核密度发射)从数据中隐式估计。
*   通过对单个或多个组件的同类行为进行聚类来估计隐藏状态。这些状态表示需要管理员识别的各种入侵活动。
*   使用先验知识或随机数据估计隐藏状态转移概率矩阵。先验知识以及长期时间特性表明状态组件从一种入侵状态转移到另一种入侵状态的近似概率。

#### 观察到的(发射)状态

观察到的状态代表使用 IC 指标通过分析或逻辑推导得出的竞争风险。机器入侵可以被认为是几个组件竞争入侵事件的结果。在该模型中，IC 引擎导出连续的多变量观察值，这类似于均值和标准差模型，只是前者基于两个或多个指标之间的相关性。这些观测值 b <sub>j</sub> (v)具有连续的概率密度函数(PDF ),并且是多元高斯(正态)分布的混合物，表示为(Lee、Kawahara 和 Shikano，2001 年)

![A978-1-4302-5990-9_11_Figu_HTML.jpg](A978-1-4302-5990-9_11_Figu_HTML.jpg)

其中![A978-1-4302-5990-9_11_Figv_HTML.jpg](A978-1-4302-5990-9_11_Figv_HTML.jpg)表示转置，并且

c <sub>jk</sub> ≥ 0 & ![A978-1-4302-5990-9_11_Figw_HTML.jpg](A978-1-4302-5990-9_11_Figw_HTML.jpg)

σ <sub>jk</sub> =第 j 个状态的第 k 个混合分量的协方差矩阵

μ <sub>jk</sub> =第 j 个状态的第 k 个混合分量的平均向量

v =观察向量

M =具有多元高斯分布的观测值的维数

θ <sub>jk</sub> = (σ <sub>jk</sub> ，μ <sub>jk</sub> ) =高斯分量

η <sub>jk</sub> =第 j 个状态的第 k 个混合成分的漂移系数

λ <sub>jk</sub> = (θ <sub>jk</sub> ，c <sub>jk</sub> ，η <sub>jk</sub> ) =用户档案组件

IC 引擎负责为所有矩阵和所有可能的攻击状态动态地重新估计λ <sub>jk</sub> 参数。代表观察维度的各种矩阵如下:

*   资源活动趋势:在一个较长的采样周期内监视的资源活动的度量，该资源活动具有在该采样周期内重复的特征。每个活动周期可以被认为是活动测量的一个额外维度。
*   事件间隔:两个连续活动(例如，日志记录尝试)之间间隔的度量。
*   事件趋势:在更长的采样周期内监视的事件的度量，目标是使用内置的可重复性计算事件行为(例如，一天中日志记录尝试的计数)。

#### 隐藏状态

隐藏状态![A978-1-4302-5990-9_11_Figx_HTML.jpg](A978-1-4302-5990-9_11_Figx_HTML.jpg)是一组不可见的状态，但每个状态随机生成 M 个观察值的混合(或可见状态 O)。后一状态的概率只取决于前一状态。完整的模型由以下概率定义:转移概率矩阵 A = a <sub>ij</sub> ，其中 A<sub>ij</sub>= p(S<sub>I</sub>| S<sub>j</sub>)；观测概率矩阵 B = (b <sub> i </sub> (v <sub>m</sub> )，其中 B<sub>I</sub>(v<sub>m</sub>)= p(v<sub>m</sub>| S<sub>I</sub>)；以及初始概率向量π = p(S <sub>i</sub> )。观察概率表示如果预期特定故障状态，则以某种概率观察到的属性。模型用 M = (A，B，π)表示。转移概率矩阵是大小等于状态数的方阵，代表状态转移概率。

观测概率分布是一个非方阵，其维数等于状态数乘以可观测量数。这种分布代表给定状态的观察概率。图 [11-15](#Fig15) 中描述的 IDS 使用这些状态:

![A978-1-4302-5990-9_11_Fig15_HTML.gif](A978-1-4302-5990-9_11_Fig15_HTML.gif)

图 11-15。

HMM model, with five intrusion states and four Gaussian distributions for each state; each Gaussian distribution can be represented as the mixture component of an observation. (Source: Khanna and Liu 2006)

*   正常(N)状态表示符合配置文件。
*   恶意入侵企图(HI)表示正在进行的恶意入侵企图。这是典型的试图绕过系统安全的外部代理。
*   友好入侵企图(FI)表示正在进行的非恶意入侵企图。这是典型的试图绕过系统安全的内部代理。
*   进行中的入侵(IP)表示正在进行自我设置的入侵活动。这包括尝试访问特权资源和加速资源使用。
*   入侵成功(IS)表示入侵成功。成功的入侵将伴随着异常的资源使用(CPU、内存、I/O 活动等)。

### 入侵检测系统体系结构

在 ad hoc 网络中，IDS 部署在节点上，独立于其他节点检测本地的入侵迹象，而不是使用路由器、网关或防火墙。在本节中，我们定义了相互协作来预测攻击状态的 IDS 组件。

在模型被训练之后，它进入运行时状态，在该状态中，它检查并分类每个有效的观察。然后，模型决定将观察结果添加到配置文件更新中，拒绝它，或者将其标记为“未分类”这个决定很重要，因为用户正常行为的偏差可能代表攻击情况。未分类的观察被监控以用于将来的分类。基于未分类状态之间趋向于某一分类的趋势相似性以及来自状态机的来自其他独立观察的反馈，该观察稍后将作为噪声被拒绝或被分类为有效状态。IDS 的各种组件如下:

*   简档估计器(PE):PE 负责维护/重新估计用户简档，将观察分类为攻击状态，在检测到可疑观察时触发警报，或者根据 HMM 反馈重新估计简档。用户档案数据由 PDF 参数![A978-1-4302-5990-9_11_Figy_HTML.jpg](A978-1-4302-5990-9_11_Figy_HTML.jpg)组成，其中 j 代表入侵状态，k 代表 GMM 混合分量。针对该简档评估新的观察，这导致其分类和漂移检测。
*   检测:检测产生事件数据，集群代理处理并使用这些数据来估计配置文件。组件识别和测量包括设置以辨别是否应该定期对事件进行采样，或者是否应该在记录模式变化时生成通知(或警报)作为事件向量。传感器数据应该能够在收集数据时或之后分析数据，并对可疑的入侵行为提供实时警报通知。这将需要能够识别、计数、阈值、时间戳、事件和清除活动的快速动作硅挂钩。这种挂钩的例子有性能计数器、翻转计数器(也称为事务计数器)、头嗅探器、错误警报(页面错误等)和带宽使用监视器。同时，还需要软件工具来对软件相关的测量进行采样，例如会话活动、各种进程和应用程序之间的系统调用使用、文件系统使用以及换入/换出使用。大多数操作系统以进程跟踪的形式支持这些挂钩(例如 UNIX 中的进程 ID [PID])。这些具有采样能力的快速作用钩子的组合被聚集以进行观察。
*   数据聚类:观察数据依赖于活动事件的聚合。例如，由资源使用引擎生成的资源故障事件被进一步分类为故障类型，例如页面故障。页面错误计数，采样间隔中的无效页面错误表示测量实例(m <sub>1</sub> ，m <sub>2</sub> )。观察值(发射)可以是一组相关的测量值，但用单一的概率分布函数表示。这些测量中的每一个都具有不同的权重，如在多元高斯分布中。例如，由于网络文件系统(NFS)，磁盘 I/O 使用可能与网络 I/O 使用相关。为了观察的完整性，这样的关系被合并到配置文件中，并且为了有效的运行时处理，减少了维度。
*   Classifier: Observation data are analyzed for the purpose of subclassification as an appropriate attack state in a profile driven by different probability distribution parameters. Once the appropriate attack state is identified, an attention event is generated to initiate a corrective or logging action. Observations are also analyzed for concept drift to compensate for changes in user (or attack) behavior. Therefore, one of the objectives of the IC engine (see Figure [11-16](#Fig16)) is to build a classifier for j (attack states) that has a posterior probability p(j|v) close to unity for one value of j and close to 0 for all the others, for each realization. This can be obtained by minimizing the Shannon entropy, given observed data v, which can be evaluated for each observation as ![A978-1-4302-5990-9_11_Figz_HTML.jpg](A978-1-4302-5990-9_11_Figz_HTML.jpg)

    ![A978-1-4302-5990-9_11_Fig16_HTML.gif](A978-1-4302-5990-9_11_Fig16_HTML.gif)

    图 11-16。

    IC engine. Reestimation of the profile uses an observation classifier and HMM feedback to the profile. The profile manager triggers an attention event if the observation classifies as an attack state or cannot be classified (U). An attention event initiates an HMM state sequence prediction, based on other, continuous observations (dotted arrows), extracted in conjunction with profiles and state transition probabilities. (Source: Khanna and Liu 2006)
*   每个内燃机独立于其他观测值(或排放)对其观测值进行采样。每当它怀疑有异常活动时，就会触发警报，从而对最可能的状态进行评估。随着系统改变其主动行为，对应于该行为的简档被更新，以通过使用实时的连续估计机制重新评估模型参数来避免假阳性评估。通过比较旧的和重新训练的模型的熵，对照历史 HMM 参数再次评估新的 HMM 参数。期望最大化(EM)算法(Moon 1996)提供了一种通用方法来解决带有未观测变量的统计模型中参数的最大似然估计(MLE)问题。评估过程产生参数集，算法使用该参数集将观察点分配给新状态。GMMs 的 EM 算法的计算复杂度为 O(i × ND <sup>2</sup> ，其中 I 为执行的迭代次数，N 为样本数，D 为状态维数。一种常见的实现选择是 k-means 算法，其中 k 个聚类由其质心参数化，复杂度为 O(kND)。也可以使用许多其他算法，包括 x-均值聚类(Pelleg 和 Moore 2000)，这将复杂度降低到 O(D)。
*   概念漂移检测器(CDD):该模块检测和分析简档中的概念漂移(Widmer 和 Kubat 1996)，当单独的训练数据集不够时，模型(简档)需要不断更新。当存在随时间演变的概念漂移时，如果新概念和旧概念仍然具有一致性，并且如果任意选择的旧数据量恰好是正确的，则不加选择地使用旧数据是有帮助的(范 2004)。这需要一种有效的数据挖掘方法，帮助选择新旧数据(历史数据)的组合，以进行准确的重新描述和进一步分类。使用的机制是 Kullback-Leibler (KL)散度(Kullback 和 Leibler 1951)，其中相对熵测量生成模型的两个概率分布之间的核距离。KL 散度也是在从先验到后验的过程中出现的香农信息的增益，表示为![A978-1-4302-5990-9_11_Figaa_HTML.jpg](A978-1-4302-5990-9_11_Figaa_HTML.jpg)
*   其中，α <sub>jkt</sub> 是 KL 散度测量值![A978-1-4302-5990-9_11_Figab_HTML.jpg](A978-1-4302-5990-9_11_Figab_HTML.jpg)，是新的高斯分量，θ <sub>jkt</sub> 是时间 t 时第 j 个状态的第 k 个混合的旧高斯分量。您可以使用大数定律(Grimmett 和 Stirzacker，1992 年)通过蒙特卡罗模拟来评估散度，它从估计的高斯分量![A978-1-4302-5990-9_11_Figac_HTML.jpg](A978-1-4302-5990-9_11_Figac_HTML.jpg)中得出观测值 v <sub>i</sub> ，计算对数比，并将其在 M 个样本上平均为![A978-1-4302-5990-9_11_Figad_HTML.jpg](A978-1-4302-5990-9_11_Figad_HTML.jpg)
*   在时间域中计算的 KL 散度数据用于评估漂移的速度(也称为漂移因子)(0 ≤ η ≤ 1)。然后，这些数据被用于为历史参数分配权重，这些权重又被用于重新配置。
*   反馈引擎(FE):该组件负责将当前状态信息反馈给 PE。使用当前 PDF 模型参数重新评估当前状态信息。然后，这个重新评估的状态信息被用于改进寻找 MLE 的下降算法。

## 配置文件和系统注意事项

在这一节中，我们来看看构成概要文件结构输入的事件。我们将这些特征定义为使用处理器功能从一个或多个时间输入事件中得到的经过处理的观察结果。

利用事件的时序信息可以提高为单个用户、程序或类定义的配置文件的性能(Ghosh、Schwartzbard 和 Schata 1999 年)。以下任何形式的异常活动都是入侵或蠕虫活动的迹象:

*   通过采样故障、处理器间中断(IPI)调用、上下文切换、线程迁移、锁旋转和使用统计来监控 CPU 活动。
*   通过采样输入错误率、冲突率、远程过程调用(RPC)拒绝率、重复确认(DUPACK)、重传率、超时率、刷新的身份验证、带宽使用、活动连接、连接建立失败、报头错误和校验和失败等来监控网络活动。
*   中断活动由采样设备中断(非定时器)监控。
*   通过对 I/O 请求的平均队列长度和繁忙百分比进行采样来监控 I/O 利用率。
*   内存活动通过采样内存传输速率、页面统计数据(回收速率、换入速率、换出速率)、地址转换故障以及短时间间隔内扫描的页面和分页平均值来监控。
*   通过对文件访问频率、文件使用溢出和文件访问故障进行采样来监控文件访问活动。
*   通过对进程优先级不合适的进程、进程使用的 CPU 和内存资源、进程的长度、阻塞 I/o 的进程、僵尸进程以及生成进程的命令和终端进行采样，可以监视系统进程活动。
*   系统故障活动表示非法活动(或硬件错误),对其进行采样是为了检测系统使用中的异常。罕见的故障是由糟糕的编程造成的，但是活动的爆发表明了攻击。
*   系统调用活动涉及获取计算机系统特权的强大工具。入侵伴随着意外系统调用的执行。如果程序的系统调用执行模式可以在它被执行之前被收集，并且用于与运行时系统调用执行行为进行比较，则可以检测到系统调用的意外执行。在实时操作期间，应用模式匹配算法来动态地匹配由被检查的进程生成的系统调用与模式表中的条目。根据匹配的好坏，决定系统调用序列代表正常还是异常行为(Wespi、Dacier 和 Debar 1999)。
*   通过采样日志记录频率、不成功的日志记录尝试、会话持续时间、会话时间和会话资源使用情况来监控会话活动。

## 传感器数据测量

传感器数据经过收集和统计处理后，可用于测量历史趋势、捕捉独特模式和可视化异常行为。数据被分类，然后被分析用于异常活动的预测。传感器数据测量包括执行统计处理功能或基础设施功能(如生成优先事件)的各种组件，如下所示:

*   Sensor data measurement (SDM) hooks reduce system complexity and increase the possibility of software reuse (see Figure [11-17](#Fig17)). SDM accelerates the combined measurement of the clustered components with an ability to send alerts, using a system’s policy. Hardware and software act as glue between transducers and a control program that is capable of measuring the event interval and the event trend and of generating alerts upon deviation from normal behavior, as defined by system policy. The SDM hardware exists as a multiple-instance entity that receives alert vectors from various events spread throughout the system. A set of correlated events that forms a cluster is registered against a common SDM instance. This instance represents the Bayes optimal decision boundaries between a set of pattern classes, with each class represented by an SDM instance and associated with a reference vector. Each SDM instance can trend and alert and integrates the measurements from the event sensors into a unified view. Cluster trending analysis is very sensitive to small signal variations and capable of detecting the abnormal signals embedded in the normal signals via supervised self-organizing maps (Kohonen 1995), using learning vector quantization (LVQ). The strategy behind LVQ is to effectively train the reference vectors to define the Bayes optimal decision boundaries between the SDM classes registered to an SDM instance.

    ![A978-1-4302-5990-9_11_Fig17_HTML.gif](A978-1-4302-5990-9_11_Fig17_HTML.gif)

    图 11-17。

    Illustration of the relationship between events (circles), sensors (SDM), and classifiers (ODC). Clusters of events (marked by common colors) are registered to an SDM. Upon evaluating the event properties, the SDM generates an event to ODC, which is responsible for classification, trend analysis, and drift calculation. Classification feedback acts as a mechanism for reestimation. (Source: Khanna and Liu 2006)
*   观察数据分类器(ODC)挂钩加速了 SDM 生成的观察警报的分类。这是能够并行处理多个观察的多实例硬件。ODC 钩子的每个登记的观察实例由每个状态的高斯概率分布参数组成。一旦接收到 SDM 警报，相应的观察就被分类为特定状态。观测数据的重新分类可能会导致与状态相对应的概率分布参数发生变化。ODC 可以使用 KL 漂移探测器保存历史参数，这些参数用于计算概念漂移特性，如漂移系数和漂移速度。
*   GMM 计算器使用当前观察值计算每个状态的高斯混合概率。在系统设置期间，针对 SDM 实例注册事件向量。这些事件在各自的传感和诊断模块中进行分组和处理。该处理包括启动观察的触发属性。这些观察然后作为一维事件被记录到它们的 ODC 中。在接收到触发信号后，ODC 对来自触发信号的观测值进行重新分类，并计算概念漂移。该硬件在其父硬件触发时被激活。

## 摘要

随着越来越多的数据以非结构化的形式数字化表达，新的计算模型正在开发中，以有意义的方式处理这些数据。通过系统地应用算法，可以应用机器学习方法来综合非结构化数据集和信息之间的基本关系。机器学习利用了概括的能力，这是通过人类学习形成概念的固有和重要组成部分。机器学习方法可以应用于开发自治系统，使用模块化功能来制定智能反馈控制系统。这种方法可以在知识功能建模中发挥关键作用，知识功能用于制定一个稳定可行的系统。本章展示了机器学习中使用的三个技术示例。第一个示例采用了工作负载指纹的概念，使用相位检测来建立表现出空间一致性和独特性的可观察特征。第二个示例基于多个计算元素之间的最佳动态能量分配概念。这个例子提出了作为压缩的代表性输出的阶段，其可以与任何其他统计参数结合使用来预测未来的行为。最后一个示例建议使用 IDS 机制来检测入侵，方法是根据用户配置文件和发展趋势来监控系统中的异常活动。每个例子都使用了一组特定应用的机器学习技术来实现预期的目标。

## 参考

贝克尔、苏珊娜和杰弗里·e·辛顿。"在随机点立体图中发现表面的自组织神经网络."自然 355，第 6356 号(1992):161–163。

Boser、Bernhard E .、Isabelle M. Guyon 和 Vladimir N. Vapnik。"一种最佳间隔分类器的训练算法."柯尔特 92:第五届计算学习理论年度研讨会论文集，144–152。纽约:美国计算机学会，1992 年。

范，魏。"挖掘概念漂移数据流的系统数据选择."KDD 04:第十届 ACM SIGKDD 知识发现和数据挖掘国际会议论文集，128–137。纽约:美国计算机学会，2004 年。

Ghosh，Anup K，Aaron Schwartzbard 和 Michael Schatz。"学习入侵检测的程序行为模式."ID' 99:第一届入侵检测和网络监控会议录。伯克利，加利福尼亚州:USENIX，1999 年。

格里梅特、杰弗里和大卫·斯特扎克。概率和随机过程。牛津:克拉伦登，1992 年。

卡纳、拉胡尔和刘华平。"基于隐马尔可夫模型的入侵检测系统方法."2006 年无线通信和移动计算国际会议论文集，349–354。纽约:美国计算机学会，2006 年。

托沃，科霍宁。"自组织地图，第三版."柏林:施普林格，1995 年。

所罗门·库尔贝克和理查德·a·莱布勒。“关于信息和充分性。”数理统计年鉴 22，第 1 号(1951):79–86。

李，昭信，川原达也，和 Shikano 清弘。"使用上下文无关 HMM 的高斯混合选择."2001 年 IEEE 声学、语音和信号处理国际会议论文集，69–72。新泽西州皮斯卡塔韦:电气和电子工程师协会，2001 年。

托德·k·穆恩，《期望最大化算法》IEEE 信号处理杂志 13，第 6 期(1996):47–60。

佩雷格、丹和安德鲁·w·摩尔。" X-Means:扩展 K-Means，有效估计聚类数."ICML 00:第十七届机器学习国际会议论文集，727–734。旧金山:摩根·考夫曼出版社，2000 年。

苏雷什.席达。“多核和 Linux 内核。”英特尔开源技术中心技术报告，2007 年。

韦斯皮、安德烈亚斯、马克·达西尔和埃尔韦·德巴尔。"基于 Teiresias 模式发现算法的入侵检测系统."《1999 年 EICAR 会议录》, Urs E. Gattiker、Pia Pedersen 和 Karsten Petersen 编辑，第 1-15 页。丹麦奥尔堡:Tim-World，1999。

威德默、格哈德和米罗斯拉夫·库巴特。"在概念漂移和隐藏环境中学习."《机器学习》23 卷，第 1 期(1996 年):69–101 页。